<head>
    <title>fields2</title>
</head>

<body>
    <h1>Fields Demo</h1>
    {{> main}}
</body>

<template name="main">
    <table class="table table-hover">{{name}}</div>
    <tbody>
    {{#each proposals}}
    <tr class="proposal"><td>{{name}}</td></tr>
    {{/each}}
    </tbody>
    </table>
    {{#if selectedProposal}}
        {{> form selectedProposal}}
    {{/if}}
</template>

<template name="form">
    <div class="container-fluid">
        <h2>{{name}}</h2>
        {{#fieldsForm 'proposal'}}
            {{#fieldsField 'summary'}}
            <div class="row-fluid">
                <span class="label">{{label}}</span>
                <span class="notification">{{notifications}}</span>
            </div>
            {{#if ready}}
                <div class="row-fluid editor">{{{value}}}</div>
            {{else}}
                LOADING
            {{/if}}
            {{/fieldsField}}
            {{#fieldsComplex 'risks'}}
            <div class="row-fluid">
                {{#fieldsField 'name'}}
                <span class="label">{{label}}</span>
                {{/fieldsField}}
                {{#fieldsField 'probability'}}
                <span class="label">{{label}}</span>
                {{/fieldsField}}
            </div>
            {{/fieldsComplex}}
            {{#fieldsField 'cost'}}
            {{> fieldRow}}
            {{/fieldsField}}
            {{#fieldsField 'projectType'}}
            <div class="row-fluid">
                <div class="control-group {{#if invalid}}error{{/if}}">
                    <span class="control-label">{{label}}</span>
                    {{#if ready}}
                    {{#if editing}}
                    <select class="fields-select">
                    {{#each choices}}
                    <option {{selected}}>{{choice}}</option>
                    {{/each}}
                    </select>
                    {{else}}
                    <span>{{value}}</span>
                    {{> editStateTrigger}}
                    {{/if}}
                    {{/if}}
                </div>
            </div>
            {{/fieldsField}}
            {{#fieldsField 'codeName'}}
            {{> fieldRow}}
            {{/fieldsField}}
        {{/fieldsForm}}
    </div>
</template>

<template name="fieldRow">
    <div class="row-fluid">
        {{#if ready}}
        <div class="control-group {{#if invalid}}error{{/if}}">
        <span class="control-label" for="{{fieldId}}">{{label}}:</span>
        {{#if editing}}
        <span class="input-append">
        <input id="{{fieldId}}" type="text" class="fields-content" value="{{value}}">
        {{#if validChange}}
        <button type="button" class="btn btn-primary fields-save"><i class="icon-white icon-ok"></i></button>
        {{/if}}
        <button type="button" class="btn fields-cancel"><i class="icon-remove"></i></button>
        </span>
        <span class="help-inline">{{hint}}</span>
        {{else}}
        <span>{{value}}</span>
        {{> editStateTrigger}}
        {{/if}}
        </div>
        {{/if}}
    </div>
</template>


<template name="editStateTrigger">
    {{#if showEditStateTrigger}}
    <button type="button" class="btn fields-edit-state-trigger"><i class="icon-pencil"></i></button>
    {{/if}}
</template>